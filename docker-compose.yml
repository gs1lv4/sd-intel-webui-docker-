services:
  webui:
    container_name: sd-intel-webui
    build: ./services/webui/
    profiles: ["webui"]
    ports:
      - "7860:7860"
    volumes:
      - "./models:/stable-diffusion-webui/models"
      - "./extensions:/stable-diffusion-webui/extensions"
      - "./outputs:/stable-diffusion-webui/outputs"
      - "./config:/config"
    devices:
      - /dev/dri/renderD128:/dev/dri/renderD128
      - /dev/dri/card0:/dev/dri/card0
    environment:
      - CLI_ARGS=--allow-code --enable-insecure-extension-access
      - PUID=1000
      - PGID=1000
    restart: unless-stopped

  download:
    build: ./services/download/
    profiles: ["download"]
    volumes:
      - "./models:/stable-diffusion-webui/models"
